---
- name: Setup personal setup, programs and dotfiles
  hosts: localhost
  remote_user: versloot
  become: yes

  tasks:
  - name: Install git
    apt:
      name: git
      state: latest

  - name: Check if dotfiles are installed
    become: no
    stat:
      path: ~/dotfiles
    register: dotfiles

  - debug: 
      msg: "Dotfiles are already installed; skip cloning repo"
    when: dotfiles.stat.exists and dotfiles.stat.isdir

  - name: Clone dotfiles repo
    become: no
    command: git clone --bare https://github.com/nyxus/dotfiles.git $HOME/dotfiles
    when: dotfiles.stat.exists == false

  - name: Checkout dotfiles
    become: no
    command: git --git-dir=$HOME/dotfiles/ --work-tree=$HOME checkout -f
    when: dotfiles.stat.exists == false

  - name: Disable untracked files
    become: no
    command:  git --git-dir=$HOME/dotfiles/ --work-tree=$HOME config --local status.showUntrackedFiles no
    when: dotfiles.stat.exists == false

  - name: Pull latest dotfiles
    become: no
    command:  git --git-dir=$HOME/dotfiles/ --work-tree=$HOME pull
    when: dotfiles.stat.exists and dotfiles.stat.isdir

  - name: Install vim
    apt:
      name: vim
      state: latest

  - name: Install htop
    apt:
      name: htop
      state: latest

  - name: Install tmux
    apt:
      name: tmux
      state: latest

  - name: Install discus
    apt:
      name: discus
      state: latest

  - name: Install zsh
    apt:
      name: zsh
      state: latest
  
  - name: Setup zsh, download antigen
    become: no
    get_url: 
      url: https://raw.githubusercontent.com/zsh-users/antigen/master/bin/antigen.zsh
      dest: ~/dotfiles/antigen.zsh

  - name: Setup zsh, install powerfonts
    apt:
      name: fonts-powerline
      state: latest

  - name: Install xclip
    apt:
      name: xclip
      state: latest

  - name: Install python pip
    apt:
      name: python-pip
      state: latest

  - name: Install python3 pip
    apt:
      name: python3-pip
      state: latest

  - name: Install curl
    apt:
      name: curl
      state: latest

  - name: Install cmake
    apt:
      name: cmake
      state: latest


  - name: Install ansible lint
    apt:
      name: ansible-lint
      state: latest

- hosts: localhost
  become: yes
  tasks:
  - name: Setup tmux, downlaod plugin manager
    git: 
      repo: 'https://github.com/tmux-plugins/tpm'
      dest: /home/versloot/.tmux/plugins/tpm
      
