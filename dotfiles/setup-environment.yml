---
- name: Setup personal setup, programs and dotfiles
  hosts: localhost
  remote_user: versloot
  become: yes

  tasks:
  - name: Install git
    apt:
      name: git
      state: latest

  - name: Check if dotfiles are installed
    become: no
    stat:
      path: ~/dotfiles
    register: dotfiles

  - debug: 
      msg: "Dotfiles are already installed; skip cloning repo"
    when: dotfiles.stat.exists and dotfiles.stat.isdir

  - name: Clone dotfiles repo
    become: no
    command: git clone --bare https://github.com/nyxus/dotfiles.git $HOME/dotfiles
    when: dotfiles.stat.exists == false

  - name: Checkout dotfiles
    become: no
    command: git --git-dir=$HOME/dotfiles/ --work-tree=$HOME checkout -f
    when: dotfiles.stat.exists == false

  - name: Disable untracked files
    become: no
    command:  git --git-dir=$HOME/dotfiles/ --work-tree=$HOME config --local status.showUntrackedFiles no
    when: dotfiles.stat.exists == false

  - name: Pull latest dotfiles
    become: no
    command:  git --git-dir=$HOME/dotfiles/ --work-tree=$HOME pull
    when: dotfiles.stat.exists and dotfiles.stat.isdir

  - name: Install VIM
    apt:
      name: vim
      state: latest

  - name: Setup VIM vundle
    become: no
    git: 
      repo: 'https://github.com/VundleVim/Vundle.vim.git'
      dest: ~/.vim/bundle/Vundle.vim

  - name: Install VIM plugins
    become: no
    command: vim +PluginInstall +qall

  - name: Install build-essential (ycm-core)
    apt:
      name: build-essential
      state: latest

  - name: Install python3-dev (ycm-core)
    apt:
      name: python3-dev
      state: latest

  - name: Install cmake
    apt:
      name: cmake
      state: latest

  - name: Install clang
    apt:
      name: clang
      state: latest

  - name: Compile VIM ycm-core
    become: no
    command: python3 install.py --clangd-completer
    args:
        chdir: '~/.vim/bundle/YouCompleteMe'

  - name: Create dirs for personal repos
    file:
      path: ~/Reposetories
      state: directory

  - name: Download YCM-config generator
    become: no
    git: 
      repo: 'https://github.com/rdnetto/YCM-Generator'
      dest: ~/Reposetories/YCM-Generator

  - name: Install htop
    apt:
      name: htop
      state: latest

  - name: Install tmux
    apt:
      name: tmux
      state: latest

  - name: Setup tmux, downlaod plugin manager
    git: 
      repo: 'https://github.com/tmux-plugins/tpm'
      dest: ~/.tmux/plugins/tpm

  - name: Install discus
    apt:
      name: discus
      state: latest

  - name: Install zsh
    apt:
      name: zsh
      state: latest

  - name: Check if antigen is available
    become: no
    stat:
      path: ~/dotfiles/antigen.zsh
    register: antigen

  - name: Setup zsh, download antigen
    become: no
    get_url: 
      url: https://raw.githubusercontent.com/zsh-users/antigen/master/bin/antigen.zsh
      dest: ~/dotfiles/antigen.zsh
    when: not antigen.stat.exists 

  - name: Setup zsh, install powerfonts
    apt:
      name: fonts-powerline
      state: latest

  - name: Install xclip
    apt:
      name: xclip
      state: latest

  - name: Install python pip
    apt:
      name: python-pip
      state: latest

  - name: Install python3 pip
    apt:
      name: python3-pip
      state: latest

  - name: Install curl
    apt:
      name: curl
      state: latest

  - name: Install ansible lint
    apt:
      name: ansible-lint
      state: latest

